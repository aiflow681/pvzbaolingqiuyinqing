
<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<head> 
	<meta charset="UTF-8" />
	<title>æ¤ç‰©å¤§æˆ˜å¤–æ˜Ÿäºº - ä¿é¾„çƒç‰ˆ</title>
	<style>
		#gameover-modal {
			display: none;
			position: fixed;
			z-index: 9999;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0,0,0,0.5);
		}
		
		#gameover-content {
			background: linear-gradient(135deg, #1a1a3e 0%, #0a0a2e 100%); /* å¤ªç©ºæ¸å˜èƒŒæ™¯ */
			color: #00ffff; /* é’è‰²æ–‡å­— */
			margin: 10% auto;
			padding: 20px;
			border-radius: 10px;
			border: 2px solid #00ffff; /* é’è‰²è¾¹æ¡† */
			width: 80%;
			max-width: 500px;
			text-align: center;
			box-shadow: 0 5px 15px rgba(0,255,255,0.3), 0 0 30px rgba(0,255,255,0.2); /* å‘å…‰æ•ˆæœ */
		}
		
		.modal-title {
			font-size: 24px;
			font-weight: bold;
			margin-bottom: 15px;
			color: #00ffff; /* å¤ªç©ºé’è‰² */
		}
		
		.modal-score {
			font-size: 18px;
			margin-bottom: 15px;
		}
		
		.modal-buttons {
			display: flex;
			justify-content: space-around;
			margin-top: 20px;
		}
		
		.modal-btn {
			padding: 10px 20px;
			font-size: 16px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			transition: background-color 0.3s;
		}
		
		#restart-btn {
			background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%); /* ç»¿è‰²æ¸å˜ */
			color: white;
			text-shadow: 0 0 5px rgba(0,0,0,0.5);
		}
		
		#restart-btn:hover {
			background: linear-gradient(135deg, #00ffaa 0%, #00dd77 100%);
			box-shadow: 0 0 15px rgba(0,255,136,0.5);
		}
		
		#refresh-btn {
			background: linear-gradient(135deg, #00ccff 0%, #0099ff 100%); /* è“è‰²æ¸å˜ */
			color: white;
			text-shadow: 0 0 5px rgba(0,0,0,0.5);
		}
		
		#refresh-btn:hover {
			background: linear-gradient(135deg, #00ddff 0%, #00aaff 100%);
			box-shadow: 0 0 15px rgba(0,204,255,0.5);
		}
	</style>
	<script src="js/jquery.js"></script>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
       body {
	background-image: url(img/background.png);
	background-size: cover;
	background-repeat: no-repeat;
	color:white;
	padding: 0;
	margin: 0;
	font-family: å¾®è½¯é›…é»‘,Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;
}
canvas {
	border: 0;
	margin: auto;	
}

a {
	color: white;
}

body {
	font-size: 12px;
}
#game {
	position: absolute;
	top:0;
	left: 0;
	width: 100%;
	height: 100%;
}

.info {
	position: absolute;
	padding: 10px;
	margin: 5px;
	background: #0a0a11;
	opacity: 0.5;
	z-index: 999;
	border-radius: 15px;
	overflow-y:auto;        
}

#loading {
	position: fixed;
	width: 90%;
	border-radius: 15px;
	z-index: 999;
	text-align: center;
	vertical-align: middle;
	line-height: 50px; 
}

#test1{
	width: 250px;
	height: 250px;
	background: #fff;
	color: #000;
	position: relative;
}

#test1 p{
	height: 25%;
	text-align: center;
	margin: 0px;
}

#test1 .cdkey a{
	color: #000;
	text-decoration: none;
	color: blue;
}

#test1 .dia-close{
	position: absolute;
	top: 0px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #000;
	background: #ccc;
}

</style>
</head>
<body>
	<div id="loading" style="display:none">
		<img width ="100%" src="img/shuoming.png">
	</div>
	
	<!-- å¤ªç©ºä¸»é¢˜æ ‡é¢˜ -->
	<div style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 1000; background: linear-gradient(135deg, #0a0a2e 0%, #1a1a3e 100%); padding: 10px 30px; border-radius: 20px; border: 2px solid #00ffff; box-shadow: 0 0 20px rgba(0,255,255,0.5);">
		<h1 style="margin: 0; color: #00ffff; font-size: 24px; text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; letter-spacing: 2px;">ğŸ›¸ æ¤ç‰©å¤§æˆ˜å¤–æ˜Ÿäºº ğŸ›¸</h1>
	</div>
	
	<div id="game"></div>
	
	<!-- æ¸¸æˆç»“æŸå¼¹çª— -->
	<div id="gameover-modal">
		<div id="gameover-content">
			<div class="modal-title">æ¸¸æˆç»“æŸ</div>
			<div class="modal-score">
				<p>æœ€ç»ˆå¾—åˆ†: <span id="final-score">0</span></p>
				<p>æœ€å¤§è¿å‡»æ•°: <span id="max-combo">0</span></p>
			</div>
			<div class="modal-buttons">
				<button id="restart-btn" class="modal-btn" onclick="hideGameOverModal(); restar();">é‡æ–°å¼€å§‹</button>
				<button id="refresh-btn" class="modal-btn" onclick="hideGameOverModal(); location.reload();">åˆ·æ–°é¡µé¢</button>
			</div>
		</div>
	</div>
<script type="text/javascript">

var lastTime = 0;

$('body').css('background-size', document.documentElement.clientWidth + 'px' + ' ' +  document.documentElement.clientHeight + 'px');



//radioä¸ºå®½é«˜æ¯”ç‡
var ratio = 1.59;

//æ¸¸æˆé«˜ä¸ºå±å¹•é«˜-20px
var height = document.documentElement.clientHeight;

// æ¸¸æˆå®½ä¸ºå±å¹•é«˜çš„1.6å€
var width = height / ratio;

//scaleä¸ºåˆ†å‰²é«˜çš„æœ€å°å•ä½
var scale = height / 720;

//å¯¼å…¥æ¸¸æˆç”»å¸ƒ
var game = new Phaser.Game(document.documentElement.clientWidth, height, Phaser.CANVAS, 'game', { preload: preload, create: create, update: update });

//é¢„å¯¼å…¥å†…å®¹
function preload() {
	//æ·»åŠ èƒŒæ™¯
	game.load.image('background', 'img/gamebackground.jpg');
	//å¼•å…¥åšæœ
	game.load.image('ball','img/bowlingball.png');
	//å·¦è¾¹æŒ‰é”®
	game.load.spritesheet('leftbtn', 'img/btn-left.png',192,720);
	//å³è¾¹æŒ‰é”®
	game.load.spritesheet('rightbtn', 'img/btn-right.png',192,720);
	// æ·»åŠ å¤–æ˜Ÿäººç²¾çµå›¾ (TODO: æ›¿æ¢ä¸ºå¤–æ˜Ÿäººå›¾ç‰‡)
	// åŸºç¡€å¤–æ˜Ÿäºº - å°å‹é£ç¢Ÿ
	game.load.spritesheet('zombie-normal', 'img/zombie-normal.png', 126, 133);
	// å¤ªé˜³å¤–æ˜Ÿäºº - å‘å…‰å¤–æ˜Ÿäºº
	game.load.spritesheet('zombie-sun', 'img/zombie-sun.png', 130, 150);
	// æ——å¸œå¤–æ˜Ÿäºº - å¸¦å¤©çº¿å¤–æ˜Ÿäºº
	game.load.spritesheet('zombie-flag', 'img/zombie-flag.png', 155, 150);
	// å¤§å¤–æ˜Ÿäºº - å¤§å‹é£èˆ¹
	game.load.spritesheet('zombie-snow', 'img/zombie-snow.png', 230,180);
	//æ·»åŠ æ°´æ²Ÿ
	game.load.image('ditchleft', 'img/ditchleft.jpg');
	game.load.image('ditchright', 'img/ditchright.jpg');

	//æ·»åŠ æŒ‰é’®
	game.load.image('button', 'img/btnreplay.png');
	//æ·»åŠ æŒ‰é’® - å·²ç§»é™¤
	// game.load.image('btnmore', 'img/btnmore.png');
	//æ·»åŠ æŒ‰é’® - å·²ç§»é™¤
	// game.load.image('btnshare', 'img/btnshare.png');
	//è¯´æ˜æŒ‰é’® - å·²ç§»é™¤
	// game.load.image('instruction','img/shuomingchakan.png');
	//æ·»åŠ å›¾ç‰‡
	game.load.image('backgroundblack', 'img/bb.jpg');
	game.load.image('gameover', 'img/over1.png');
}


//èƒŒæ™¯
var bg1;
var bg2;

//èƒŒæ™¯æ»šåŠ¨é€Ÿç‡
var scrollSpeed = 5 ;																								

//åŸºç¡€é€Ÿåº¦
const baseVelocity = 10 * scale;

//åŠ å…¥åŸºç¡€å¤–æ˜Ÿäºº
var zombies; // å¤–æ˜Ÿäººç»„
var zombie = null; // å•ä¸ªå¤–æ˜Ÿäºº
//å¼•å…¥åŸºç¡€å¤–æ˜Ÿäººå‡½æ•°
var timer1;
var timer2;
var timer3;
var timer4;
//åˆ†æ•°
var score = 0;
var scoreText;
var middletext;
var addscoreText = 0;
//è¿å‡»æ•°
var comboText;
var maxcomboText;
var combo = 0;
var maxcombo = 0;
var combaddscoreText = 0;
//å¤–æ˜Ÿäººèº«ä½“ç¢°æ’åŸºæ•°
var zombieBodySize = 0.5;

var button2 = null;
var encouragetext = null;
var encouragetext2 = null;
var keyvalue = null;


//åˆ›å»ºæ¸¸æˆèƒŒæ™¯
function createBackground() {
	bg1 = game.add.sprite(0, 0, 'background');
	bg2 = game.add.sprite(0, -bg1.height * scale, 'background');
	bg1.width = document.documentElement.clientWidth;
    bg2.width = document.documentElement.clientWidth;
	bg1.scale.y = scale;
    bg2.scale.y = scale;
	
	// å¤ªç©ºä¸»é¢˜ - æ·±è“ç´«è‰²è°ƒ
	bg1.tint = 0x0d1a4d;
	bg2.tint = 0x0d1a4d;
}
//åˆ›å»ºä¿é¾„çƒ
function createBall(){
	ball = game.add.sprite(game.world.centerX,game.world.height-200*scale, 'ball');
	ball.scale.setTo(0.1*scale,0.1*scale);
	ball.anchor.setTo(0.5, 0.5);
	game.physics.arcade.enable(ball);
}
//æ·»åŠ åŸºç¡€å¤–æ˜Ÿäºº
function addZombie(){
	var zombie = zombies.create(30*scale+(game.world.width-156*scale)*Math.random(),-133*scale, 'zombie-normal');
	zombie.scale.setTo(scale,scale);
	zombie.animations.add('alive', [0,1,2,3,2,1],5, true);
	zombie.animations.add('dead', [7,8,9,10,11,12,13],15, true);
	zombie.animations.play('alive');
	zombie.outOfBoundsKill = true;
	zombie.body.setSize(zombie.body.width*zombieBodySize,zombie.body.height*zombieBodySize,38*scale,0);
	zombie.body.velocity.y = 300*scale;
}
//æ·»åŠ å¤ªé˜³å¤–æ˜Ÿäºº
function addSunZombie(){
	var sunZombie = sunZombies.create(30*scale+(game.world.width-160*scale)*Math.random(),-150*scale, 'zombie-sun');
	sunZombie.scale.setTo(scale,scale);
	sunZombie.animations.add('alive', [0,1,2,3,4,5,6,7,8,9,8,7,6,5,4,3,2,1],5, true);
	sunZombie.animations.add('dead', [10,11,12,13,14,15,16,17],15, true);
	sunZombie.animations.play('alive');
	sunZombie.outOfBoundsKill = true;
	sunZombie.body.setSize(sunZombie.body.width*zombieBodySize,sunZombie.body.height*zombieBodySize,39*scale,0);
	sunZombie.body.velocity.y = 300*scale;
}
//æ·»åŠ æ——å­åƒµå°¸
function addFlagZombie(){
	var flagZombie = flagZombies.create(30*scale+(game.world.width-185*scale)*Math.random(),-150*scale, 'zombie-flag');
	flagZombie.scale.setTo(scale,scale);
	flagZombie.animations.add('alive', [0,1,2,3,4,3,2,1],5, true);
	flagZombie.animations.add('dead', [5,6,7,8,9,10,11,12,13],15, true);
	flagZombie.animations.play('alive');
	flagZombie.outOfBoundsKill = true;
	flagZombie.body.setSize(flagZombie.body.width*zombieBodySize,flagZombie.body.height*zombieBodySize,55.5*scale,0);
	flagZombie.body.velocity.y = 300*scale;
}

//æ·»åŠ å¤§åƒµå°¸
function addBigZombie(){
	var bigzombie = bigZombies.create(5*scale+(game.world.width-230*scale)*Math.random(),-180*scale, 'zombie-snow');
	bigzombie.scale.setTo(scale,scale);
	bigzombie.animations.add('alive', [0,1,2,3,4,5,4,3,2,1],5, true);
	bigzombie.animations.add('dead', [6,7,8,9,10,11,12],15, true);
	bigzombie.animations.play('alive');
	bigzombie.outOfBoundsKill = true;
	bigzombie.body.setSize(bigzombie.body.width*zombieBodySize, bigzombie.body.height*zombieBodySize,0);
	bigzombie.body.velocity.y = 300*scale;
}
function create() {
	game.physics.startSystem(Phaser.Physics.ARCADE);
	
	//å¼•å…¥èƒŒæ™¯
    createBackground();
	
	//åŠ å…¥æ°´æ²Ÿ
	ditchleft = game.add.sprite(0, 0, 'ditchleft');
	ditchleft.scale.setTo(scale, scale);
	game.physics.arcade.enable(ditchleft);
	ditchright = game.add.sprite(game.world.width, 0, 'ditchright');
	ditchright.scale.setTo(scale, scale);
	ditchright.anchor.setTo(1,0);
	game.physics.arcade.enable(ditchright);
	
	//åŠ å…¥åƒµå°¸
	zombies = game.add.group();
	zombies.enableBody = true;
	timer1 = game.time.events.loop(400+600*Math.random(), addZombie, this);
	//åŠ å…¥å¤ªé˜³åƒµå°¸
	sunZombies = game.add.group();
	sunZombies.enableBody = true;
	timer3 = game.time.events.loop(2000+3000*Math.random(), addSunZombie, this);
	//åŠ å…¥æ——å­åƒµå°¸
	flagZombies = game.add.group();
	flagZombies.enableBody = true;
	timer4 = game.time.events.loop(2000+3000*Math.random(), addFlagZombie, this);
	//åŠ å…¥å¤§åƒµå°¸
	bigZombies = game.add.group();
	bigZombies.enableBody = true;
	timer2 = game.time.events.loop(4000+2000*Math.random(), addBigZombie, this);
	
	//æ·»åŠ åˆ†æ•°
	scoreText = game.add.text(0, game.world.centerY-285*scale, 'score: 0');
	addscoreText = game.add.text(0,game.world.centerY-220*scale,'åŠ åˆ†:0');
	scoreText.setStyle({stroke:'#1d492f',fill:'white', strokeThickness:10,font:'bold ' + width/10 + 'px' + ' å¾®è½¯é›…é»‘'});
	addscoreText.setStyle({stroke:'#1d492f',fill:'white', strokeThickness:10,font:'bold ' + width/10 + 'px' + ' å¾®è½¯é›…é»‘'});
	addscoreText.visible = false;
	scoreText.visible = false; // éšè—åˆ†æ•°
	//æ·»åŠ è¿å‡»æ•°
	comboText = game.add.text(0,game.world.centerY-270*scale,'Combo:0');
	comboText.setStyle({stroke:'#ff6600',fill:'#ffea89', strokeThickness:10,font:'bold ' + width/10 + 'px' + ' å¾®è½¯é›…é»‘'});
	comboText.anchor.setTo(0,1);
	comboText.visible = false; // éšè—è¿å‡»
	combaddscoreText = game.add.text(0,game.world.centerY-150*scale,'è¿å‡»å¥–åŠ±:0' )
	combaddscoreText.setStyle({stroke:'#5d1f1f',fill:'#ff6600', strokeThickness:10,font:'bold ' + width/10 + 'px' + ' å¾®è½¯é›…é»‘'});
	combaddscoreText.visible = false;
		
	//å¼•å…¥ä¿é¾„çƒ
	createBall();
	
	//ä»¥ä¸‹æ˜¯å¼•å…¥å…³è”
	//å¼•å…¥å‘å·¦èµ°æŒ‰é’®
	buttonleft = game.add.button(0,game.world.height-20*scale, 'leftbtn', actionMoveleft, this, 0, 0, 1,0);
	buttonleft.anchor.setTo(0, 1);
	buttonleft.scale.setTo(scale, scale);

	//å¼•å…¥å‘å³èµ°æŒ‰é’®
	buttonright = game.add.button(game.world.width,game.world.height-20*scale, 'rightbtn', actionMoveright, this, 0, 0, 1,0);
	buttonright.anchor.setTo(1, 1);
	buttonright.scale.setTo(scale, scale);
	
	//æ·»åŠ é”®ç›˜æ”¯æŒ - å·¦å³ç®­å¤´é”®
	var leftKey = game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
	var rightKey = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);
	
	leftKey.onDown.add(actionMoveleft, this);
	rightKey.onDown.add(actionMoveright, this);
	
	//æ·»åŠ è¯´æ˜æŒ‰é’® - å·²ç§»é™¤
	// buttoninstruction = game.add.button(game.world.width,0, 'instruction', actionInstruction, this, 0, 0, 0);
	// buttoninstruction.anchor.setTo(1,0);
	// buttoninstruction.scale.setTo(1.1*scale, 1.1*scale);
}


//èƒŒæ™¯åŠ¨æ€å‡½æ•°
function updateBackground() {

	bg1.y = bg1.y + scrollSpeed * scale;
	bg2.y = bg2.y + scrollSpeed * scale;

	if (bg1.y >= height) {
		bg1.y = bg2.y - bg1.height;
	}
	if (bg2.y >= height) {
		bg2.y = bg1.y - bg2.height;
	}
}

var moveSpeed = 0;
var nowtime = 0;

function update() {

	//å¼ºåˆ¶éšè—åˆ†æ•°å’Œè¿å‡»æ˜¾ç¤º
	if(scoreText) scoreText.visible = false;
	if(comboText) comboText.visible = false;
	if(addscoreText) addscoreText.visible = false;
	if(combaddscoreText) combaddscoreText.visible = false;

	//ä½¿èƒŒæ™¯å˜æˆåŠ¨æ€
	updateBackground();
	//ä½¿ä¿é¾„çƒè½¬åŠ¨
	ball.angle = ball.angle+4;
	//çƒç¢°åˆ°åƒµå°¸åæ€æ­»åƒµå°¸
	game.physics.arcade.overlap(ball, zombies, killZombie, null, this);
	game.physics.arcade.overlap(ball, bigZombies, killbigZombie, null, this);
	game.physics.arcade.overlap(ball, sunZombies, killsunZombie, null, this);
	game.physics.arcade.overlap(ball, flagZombies, killflagZombie, null, this);
	//çƒç¢°åˆ°å·¦å³è¾¹ç¼˜ï¼Œæ¸¸æˆç»“æŸ
	game.physics.arcade.overlap(ball, ditchleft, leftkillball, null, this);
	game.physics.arcade.overlap(ball, ditchright, rightkillball, null, this);

	lastTime = Date.now();
	nowtime++;
	if (nowtime > 10)
	{
		moveSpeed++;
		nowtime = 0;
	};
	
}


//æ€æ­»åƒµå°¸
function killZombie(ball,zombie){
	zombie.animations.play('dead',null,false,true);
	if(ball.x<=zombie.x+zombie.body.width/2){
		ball.body.velocity.x-=(zombie.x+zombie.body.width/2-ball.x)*scale/90;
		zombie.angle = zombie.angle-0.5;
		if(zombie.angle==-2){
			beadcombo();
			score += 200;
			scoreText.text = 'score: ' + score;
			addscoreText.visible = true;
			addscoreText.text = 'åŠ åˆ†:+' + 200;
		}
	}else{
		ball.body.velocity.x+=(ball.x-zombie.x-zombie.body.width/2)*scale/90;
		zombie.angle = zombie.angle+0.5;
		if(zombie.angle==2){
			beadcombo();
			score += 200;
			scoreText.text = 'score: ' + score;
			addscoreText.visible = true;
			addscoreText.text = 'åŠ åˆ†:+' + 200;
		}
	}
	 
}
//æ€æ­»å¤ªé˜³åƒµå°¸
function killsunZombie(ball,sunZombie){
	sunZombie.animations.play('dead',null,false,true);
	sunZombie.angle = sunZombie.angle+0.5;
	if(sunZombie.angle==2){
		beadcombo();
		score += 300;
		scoreText.text = 'score: ' + score;
		addscoreText.visible = true;
		addscoreText.text = 'åŠ åˆ†:+' + 300;
		//zombie.exists = false;
	}
}


//æ€æ­»æ——å­åƒµå°¸
function killflagZombie(ball,flagZombie){

	flagZombie.animations.play('dead',null,false,true);
	flagZombie.angle = flagZombie.angle+0.5;
	if(flagZombie.angle==2){
		beadcombo();
		score += 300;
		scoreText.text = 'score: ' + score;
		addscoreText.visible = true;
		addscoreText.text = 'åŠ åˆ†:+' + 300;
		//zombie.exists = false;
	}
}
//æ€æ­»å¤§åƒµå°¸
function killbigZombie(ball,bigZombie){

	bigZombie.animations.play('dead',null,false,true);
	if(ball.x<=bigZombie.x+bigZombie.body.width/2){
		ball.body.velocity.x-=(bigZombie.x+bigZombie.body.width/2-ball.x)*scale/30;
		bigZombie.angle = bigZombie.angle-0.5;
		if(bigZombie.angle==-2){
			beadcombo();
			score += 400;
			scoreText.text = 'score: ' + score;
			addscoreText.visible = true;
			addscoreText.text = 'åŠ åˆ†:+' + 400;
		}
	}else{
		ball.body.velocity.x+=(ball.x-bigZombie.x-bigZombie.body.width/2)*scale/30;
		bigZombie.angle = bigZombie.angle+0.5;
		if(bigZombie.angle==2){
			beadcombo();
			score += 400;
			scoreText.text = 'score: ' + score;
			addscoreText.visible = true;
			addscoreText.text = 'åŠ åˆ†:+' + 400;
		}
	}
	 
}
var combotime
function beadcombo(){
	if(combo==0){
		combotime = Date.now();
		combo += 1;
		comboText.text = 'Combo:' + combo;
	}else if(Date.now()-combotime<=800){
		combo += 1;
		comboText.text = 'Combo:' + combo;
		if(combo>5){
			score += 5*combo;
			scoreText.text = 'score: ' + score;
			combaddscoreText.text='è¿å‡»å¥–åŠ±:+'+ 50*combo;
			combaddscoreText.visible = true;
		}
		combotime = Date.now();
	}else{
		if(maxcombo<combo){
			maxcombo = combo;
		}
		combo = 1;
		comboText.text = 'Combo:' + combo;
		combotime = Date.now();
		combaddscoreText.visible =false;
	}
}
function leftkillball(ball,ditchleft){
	gameover();
}

function rightkillball(ball,ditchright){
	gameover();
}


//æ¸¸æˆç»“æŸ
function gameover(){
	ball.kill();
	if(maxcombo<combo){
		maxcombo = combo;
	}
	
	// æ˜¾ç¤ºæ¸¸æˆç»“æŸå¼¹çª—
	showGameOverModal();
	
	// åˆ›å»ºåŠé€æ˜èƒŒæ™¯
	backgroundblack = game.add.button(0,0,"backgroundblack");
	backgroundblack.alpha=0.7;
	backgroundblack.scale.setTo(10*scale,20*scale);
	backgroundblack.width = document.documentElement.clientWidth;
	
	//Scoreæ˜¾ç¤º
	finalscore = game.add.text(width/2 - width/3,game.world.centerY-280*scale, scoreText.text);
	finalscore.anchor.setTo(0, 0.5);
	finalscore.setStyle({stroke:'#111',fill:'white', strokeThickness:10,font:'bold ' + width/14 + 'px' + ' å¾®è½¯é›…é»‘'});

	//æœ€å¤§è¿å‡»æ•°
	maxcomboText = game.add.text(width/2 - width/3,game.world.centerY-235*scale, 'æœ€å¤§è¿å‡»æ•°:'+maxcombo);
	maxcomboText.setStyle({stroke:'#111',fill:'white', strokeThickness:10, font:'bold ' + width/14 + 'px' + ' å¾®è½¯é›…é»‘'});
	maxcomboText.anchor.setTo(0, 0.5);

	encouragetext = game.add.text(width/2 - width/3, game.world.centerY-190*scale, 'æ­å–œä½ æˆåŠŸç¢¾å‹å¤–æ˜Ÿäººï¼');
	encouragetext.anchor.setTo(0, 0.5);
	encouragetext.setStyle({stroke:'#111',fill:'white', strokeThickness:10,font:'bold ' + width/14 + 'px' + ' å¾®è½¯é›…é»‘'});

	// é‡æ–°å¼€å§‹æŒ‰é’® - ç¡®ä¿åœ¨å±å¹•ä¸­å¤®ä¸”å¯è§
	copy = game.add.button(game.world.centerX, game.world.centerY-10*scale, 'button', restar, this, 2, 1, 0);
	copy.scale.setTo(0.5*scale,0.6*scale);
	copy.anchor.setTo(0.5,0.5);
	copy.visible = true; // ç¡®ä¿æŒ‰é’®å¯è§
	copy.alpha = 1.0; // ç¡®ä¿æŒ‰é’®ä¸é€æ˜
	
	game.time.events.pause();
	game.time.events.remove();
}
//æ¸¸æˆé‡æ–°å¼€å§‹
function restar(){
	// éšè—æ¸¸æˆç»“æŸå¼¹çª—
	hideGameOverModal();
	
	score = 0;
	combo = 0;
	maxcombo = 0;
	addscoreText.text = 'åŠ åˆ†:+' + 0;
	scoreText.text = 'score: ' + score;
	comboText.text = 'Combo:' + 0;
	
	// å®‰å…¨åœ°æ¸…ç†èƒŒæ™¯é»‘è‰²é®ç½©
	if (typeof backgroundblack !== 'undefined' && backgroundblack != null) {
		backgroundblack.kill();
	}

	if (typeof maxcomboText != 'undefined') {
		maxcomboText.visible = false;
	};

	if (typeof finalscore != 'undefined') {
		finalscore.visible = false;
	};

	if (typeof middletext != 'undefined') {
		middletext.visible = false;
	};

	if (typeof addscoreText != 'undefined') {
		addscoreText.visible = false;
	};

	if (typeof combaddscoreText != 'undefined') {
		combaddscoreText.visible = false;
	};

	if (typeof encouragetextbtm1 != 'undefined') {
		encouragetextbtm1.visible = false;
	};

	if (typeof encouragetextbtm2 != 'undefined') {
		encouragetextbtm2.visible = false;
	};

   	if (encouragetext!=null) {
		encouragetext.visible = false;
	}

	if (encouragetext2!=null) {
		encouragetext2.visible = false;
	}

	if (typeof combaddscoreText != 'undefined') {
		combaddscoreText.visible = false;
	};

	if (typeof button != 'undefined') {
		button.kill();
	}

	if (typeof button360 != 'undefined') {
		button360.kill();
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	if (typeof button3602 != 'undefined') {
		button3602.kill();
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////

	if (button2!=null) {
		button2.kill();
	}

	if (typeof key != 'undefined') {
		key.visible = false;
	};

	if (typeof copy != 'undefined') {
		copy.visible = false;
	};

	if (keyvalue != null) {
		keyvalue.visible = false;
	};

	zombies.destroy(true,true);
	sunZombies.destroy(true,true);
	flagZombies.destroy(true,true);
	bigZombies.destroy(true,true);
	game.time.events.resume();
	timer1;
	timer2;
	timer3;
	timer4;

	ball.reset(game.world.centerX,game.world.height-200*scale);
	ball.revive();

	moveSpeed = 0;
	nowtime = 0;
}



//æ¸¸æˆé‡æ–°å¼€å§‹
function restar1(){
	buttonshare.kill();	
	backgroundblack2.kill();	

}



var leftSpeed = 4;
var rightSpeed = 4;


//ä»¥ä¸‹æ˜¯actionå‡½æ•°
//å‘å·¦ç§»åŠ¨
function actionMoveleft() {

	if(leftSpeed < 14) leftSpeed++;
	if(rightSpeed > 0) rightSpeed --;
	var deltaVel = baseVelocity * leftSpeed;
	ball.body.velocity.x-=deltaVel + moveSpeed;
}

//å‘å³ç§»åŠ¨
function actionMoveright() {

	if(rightSpeed < 14) rightSpeed++;
	if(leftSpeed > 0)   leftSpeed--;
	var deltaVel = baseVelocity * rightSpeed;
	ball.body.velocity.x+=deltaVel + moveSpeed;
	
}

function actionInstruction(){

	$('#loading').css({

		'width' : document.documentElement.clientWidth + 'px',
		'height' : height + 'px',
		'left' : (document.documentElement.clientWidth - document.documentElement.clientWidth) / 2 + 'px',
	});

	$('#loading img').css('height', height + 'px');

	$("#loading").toggle();

	window.setTimeout(function(){
		$('#loading').css('font-size', '100px');
	},600);
}
$("#loading").click(function(){
	if ($('#loading').css('font-size') != '100px') {
		return;
	};
	$("#loading").toggle();
	$('#loading').css('font-size', '0px');
});

function deleteScore(str)
{
	var start = str.indexOf(':');
	var end = str.length;
	str = str.substr(start+1, end);
	return str;
}


//å¼¹çª— + è®¾ç½®cdkeyçš„å€¼ 
function setCDKey(val)
{
	$('#cdkey').html(val);
}

function TGDialogS(e){

	var w = document.documentElement.clientWidth;
	var h = document.documentElement.clientHeight;

	//è®¾ç½®test1çš„å®½é«˜
	$('#test1').css({
		'width' : w / 1.1 + 'px',
		'height' : h / 3 + 'px'
	});

	//è®¾ç½®pçš„å­—ä½“å¤§å°
	$('#test1 p').eq(0).css('font-size' , h*0.07/2 + 'px').css('margin-top' , deletePX( $('#test1').css('height') ) / 3 );
	$('#test1 p').eq(1).css('font-size' , h*0.05/2 + 'px');

	//è®¾ç½®å…³é—­æŒ‰é’®
	$('#test1 .dia-close').css({
		'width' : h / 10 + 'px',
		'height' : h / 15 + 'px',
		'left' : deletePX( $('#test1').css('width') ) - h / 10 + 'px',
	});
	var closeH = deletePX ( $('#test1 .dia-close').css('height') );
	$('#test1 .dia-close').css('font-size', closeH/2 + 'px').css('line-height', closeH + 'px');

	need("biz.dialog-min",function(Dialog){
		Dialog.show({
			id:e,
			bgcolor:'#000', //å¼¹å‡ºâ€œé®ç½©â€çš„é¢œè‰²ï¼Œæ ¼å¼ä¸º"#FF6600"ï¼Œå¯ä¿®æ”¹ï¼Œé»˜è®¤ä¸º"#fff"
			opacity:50      //å¼¹å‡ºâ€œé®ç½©â€çš„é€æ˜åº¦ï¼Œæ ¼å¼ä¸ºï½›10-100ï½ï¼Œå¯é€‰
		});
	});
}

function closeDialog(){
	need("biz.dialog-min",function(Dialog){
		Dialog.hide();
	});
}

function deletePX(str)
{
  if (typeof str == 'undefined') return ;
  str = str.substr(0, str.length-2);
  return parseInt(str);
}
</script>
<script language=javascript>
		// ç§»é™¤å¤–éƒ¨é“¾æ¥å’Œåˆ†äº«æ•°æ®
var is9gUser=false;
				
		function goHome(){
			window.location=mebtnopenurl;
		}
		function clickMore(){
			if((window.location+"").indexOf("zf",1)>0){
				window.location =mebtnopenurl;
			 }
			 else{
				goHome();
			 }
		// ç§»é™¤åˆ†äº«åŠŸèƒ½
function dp_share(){
	// æ˜¾ç¤ºåˆ†äº«æç¤º
	var shareDiv = document.getElementById("share");
	if (shareDiv) {
		shareDiv.style.display = "";
	}
}
			
		}
		function dp_Ranking(){
			window.location=mebtnopenurl;
		}

		function showAd(){
		}
		function hideAd(){
		}
		// ç§»é™¤åˆ†äº«ç›¸å…³ä»£ç 
		var WeixinJSBridge = null;
		if (typeof WeixinJSBridge !== 'undefined') {
			WeixinJSBridge.on('menu:share:appmessage', function(argv) {
				// ç§»é™¤å®é™…åˆ†äº«åŠŸèƒ½
			});

			WeixinJSBridge.on('menu:share:timeline', function(argv) {
				// ç§»é™¤å®é™…åˆ†äº«åŠŸèƒ½
			});
		}
		
		// æ¸¸æˆç»“æŸå¼¹çª—ç›¸å…³å‡½æ•°
		function showGameOverModal() {
			// æ›´æ–°åˆ†æ•°æ˜¾ç¤º
			if (document.getElementById('final-score')) {
				document.getElementById('final-score').textContent = score;
			}
			if (document.getElementById('max-combo')) {
				document.getElementById('max-combo').textContent = maxcombo;
			}
			
			// æ˜¾ç¤ºå¼¹çª—
			var modal = document.getElementById('gameover-modal');
			if (modal) {
				modal.style.display = 'block';
			}
		}
		
		function hideGameOverModal() {
			var modal = document.getElementById('gameover-modal');
			if (modal) {
				modal.style.display = 'none';
			}
		}
		
		function setupModalButtons() {
			// ç»‘å®šé‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
			var restartBtn = document.getElementById('restart-btn');
			if (restartBtn) {
				restartBtn.addEventListener('click', function() {
					hideGameOverModal();
					restar();
				});
			}
			
			// ç»‘å®šåˆ·æ–°é¡µé¢æŒ‰é’®äº‹ä»¶
			var refreshBtn = document.getElementById('refresh-btn');
			if (refreshBtn) {
				refreshBtn.addEventListener('click', function() {
					hideGameOverModal();
					location.reload();
				});
			}
		}
		
		// ç«‹å³å°è¯•è®¾ç½®æŒ‰é’®äº‹ä»¶ï¼ˆå¦‚æœDOMå·²åŠ è½½ï¼‰
		if (document.readyState === 'loading') {
			// DOMä»åœ¨åŠ è½½ï¼Œç›‘å¬DOMContentLoadedäº‹ä»¶
			document.addEventListener('DOMContentLoaded', setupModalButtons);
		} else {
			// DOMå·²åŠ è½½å®Œæˆ
			setupModalButtons();
		}
		</script>
		<div id=share style="display: none">
			<img width=100% src="share.png"
				style="position: fixed; z-index: 9999; top: 0; left: 0; display: none;"
				ontouchstart="document.getElementById('share').style.display='none';" />
		</div>
		<div style="display: none;">
			<script type="text/javascript">
            var myData = { gameid: "zwdzjs" };
			
			function dp_submitScore(score){
				myData.score = parseInt(score);
				myData.scoreName = "è·å¾—"+score+"åˆ†";
					document.title ="æˆ‘ä¸€ä¸¾æ¶ˆå¤±äº†å…¥ä¾µçš„ä¸§å°¸è·å¾—äº†"+score+"åˆ†ï¼Œä¸§å°¸å·²ç°ä¸–ï¼Œå¿«æ¥ä¸€èµ·æ¶ˆç­ä»–ä»¬å§ï¼";
					window.shareData.tTitle = document.title;
			}	 
			</script>
			<div style="display: none;">
				
			</div>
			  
</body>
</html>